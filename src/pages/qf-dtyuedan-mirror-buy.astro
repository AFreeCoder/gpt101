---
import Layout from '~/layouts/Layout.astro';
import Header from '~/components/widgets/Header.astro';
import Footer from '~/components/widgets/Footer.astro';
import { headerData, footerData } from '~/navigation';
import { siteConfig } from '~/config/site';

const metadata = {
  title: '镜像服务购买 - 快捷通道',
  description: '站内直达镜像服务购买页面，如无法加载可在新窗口打开。',
  ignoreTitleTemplate: true,
};

const targetUrl =
  (siteConfig.mirrorPage.links as { purchaseEmbed?: string }).purchaseEmbed ||
  'https://fe.dtyuedan.cn/shop/F2OLER91/3fptbk';
---

<Layout metadata={metadata}>
  <style>
    :global(body) {
      background: #ffffff;
    }
  </style>
  <Header {...headerData} isSticky showRssFeed={false} showToggleTheme={false} />
  <main class="bg-white">
    <iframe
      id="mirror-purchase-iframe"
      src={targetUrl}
      title="镜像服务购买"
      class="w-full border-0 block"
      loading="lazy"
      referrerpolicy="no-referrer"
      allowfullscreen></iframe>
  </main>
  <Footer {...footerData} />
  <script is:inline>
    (() => {
      const iframe = document.getElementById('mirror-purchase-iframe');
      const header = document.getElementById('header');
      const footer = document.querySelector('footer');
      if (!iframe) return;

      const setHeight = () => {
        const headerH = header?.offsetHeight || 0;
        const footerH = footer?.offsetHeight || 0;
        const available = Math.max(window.innerHeight - headerH - footerH, 0);
        iframe.style.height = `${Math.max(available, 900)}px`;
      };

      setHeight();
      window.addEventListener('resize', setHeight);
      document.addEventListener('astro:page-load', setHeight);

      const resizeObserver = new MutationObserver(setHeight);
      if (footer) {
        resizeObserver.observe(footer, { childList: true, subtree: true });
      }

      window.addEventListener('astro:before-swap', () => {
        window.removeEventListener('resize', setHeight);
        document.removeEventListener('astro:page-load', setHeight);
        resizeObserver.disconnect();
      });
    })();
  </script>
</Layout>
